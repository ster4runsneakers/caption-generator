<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Social Media Assistant v3.0</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

    <div class="container">
        <div class="theme-switch" id="theme-switch" title="Toggle dark mode">ğŸŒ™</div>
        <h1>AI Social Media Assistant v3.0</h1>

        <div class="app-tabs">
            <button id="tab-text" class="active">Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± ÎšÎµÎ¹Î¼Î­Î½Î¿Ï…</button>
            <button id="tab-image">Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î•Î¹ÎºÏŒÎ½Î±Ï‚</button>
            <button id="tab-calendar">Î—Î¼ÎµÏÎ¿Î»ÏŒÎ³Î¹Î¿</button>
            <button id="tab-history">Î™ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ</button>
            <button id="tab-settings">Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚</button>
        </div>
        
        <div class="view-content">
            <div id="view-text" class="view-container active">
                <p>Î”Î·Î¼Î¹Î¿ÏÏÎ³Î·ÏƒÎµ Hooks, CTAs ÎºÎ±Î¹ Captions Î³Î¹Î± Ï„Î± social media ÏƒÎ¿Ï….</p>
                <div class="form-controls">
                    <input type="text" id="topic-input" placeholder="ÎšÏÏÎ¹Î¿ Î¸Î­Î¼Î±...">
                    <input type="text" id="keywords" placeholder="Î›Î­Î¾ÎµÎ¹Ï‚-ÎºÎ»ÎµÎ¹Î´Î¹Î¬...">
                    <select id="platform-select">
                        <option value="Instagram">Instagram</option>
                        <option value="TikTok">TikTok</option>
                        <option value="Facebook">Facebook</option>
                        <option value="Pinterest">Pinterest</option>
                        <option value="YouTube">YouTube</option>
                    </select>
                    <select id="content-type-select">
                        <option value="Caption">Full Caption</option>
                        <option value="Hook">ÎœÏŒÎ½Î¿ Hook</option>
                        <option value="CTA">ÎœÏŒÎ½Î¿ CTA</option>
                        <option value="Hashtags">ÎœÏŒÎ½Î¿ Hashtags</option>
                    </select>
                    <select id="tone-select">
                        <option value="Friendly">Î¦Î¹Î»Î¹ÎºÏŒ</option>
                        <option value="Professional">Î•Ï€Î±Î³Î³ÎµÎ»Î¼Î±Ï„Î¹ÎºÏŒ</option>
                        <option value="Funny">Î‘ÏƒÏ„ÎµÎ¯Î¿</option>
                        <option value="Enthusiastic">Î•Î½Î¸Î¿Ï…ÏƒÎ¹ÏÎ´ÎµÏ‚</option>
                    </select>
                    <select id="language-select">
                        <option value="Greek">Î•Î»Î»Î·Î½Î¹ÎºÎ¬</option>
                        <option value="English">Î‘Î³Î³Î»Î¹ÎºÎ¬</option>
                    </select>
                    <select id="model-select" title="Choose your AI engine">
                        <option value="openai">OpenAI (GPT-3.5)</option>
                        <option value="gemini">Google (Gemini)</option>
                    </select>
                </div>
                <button id="generate-text-btn">Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± ÎšÎµÎ¹Î¼Î­Î½Î¿Ï…</button>
            </div>

            <div id="view-image" class="view-container">
                 <div class="form-section">
                    <h3>Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î¼Îµ AI</h3>
                    <p>Î ÎµÏÎ¹Î­Î³ÏÎ±ÏˆÎµ Ï„Î·Î½ ÎµÎ¹ÎºÏŒÎ½Î± Ï€Î¿Ï… Î¸Î­Î»ÎµÎ¹Ï‚ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Ï„Î¿ AI.</p>
                    <div class="form-controls">
                        <input type="text" id="image-prompt-input" placeholder="Ï€.Ï‡., ÎˆÎ½Î±Ï‚ Î±ÏƒÏ„ÏÎ¿Î½Î±ÏÏ„Î·Ï‚ ÏƒÎµ Î¼Î¹Î± Ï€Î±ÏÎ±Î»Î¯Î±, ÏÎµÎ±Î»Î¹ÏƒÏ„Î¹ÎºÏŒ ÏƒÏ„Ï…Î»...">
                        <select id="image-style-select">
                            <option value="photorealistic">Î¦Ï‰Ï„Î¿ÏÎµÎ±Î»Î¹ÏƒÏ„Î¹ÎºÏŒ</option>
                            <option value="digital art">Digital Art</option>
                            <option value="cartoon">Cartoon</option>
                            <option value="fantasy">Fantasy</option>
                            <option value="3d render">3D Render</option>
                        </select>
                    </div>
                    <button id="generate-image-btn">Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î•Î¹ÎºÏŒÎ½Î±Ï‚ Î¼Îµ AI</button>
                </div>
                <div class="form-section">
                    <h3>Î‘Î½Î­Î²Î±ÏƒÎ¼Î± Î”Î¹ÎºÎ®Ï‚ ÏƒÎ¿Ï… Î•Î¹ÎºÏŒÎ½Î±Ï‚</h3>
                    <div class="upload-section">
                        <input type="file" id="file-input" accept="image/png, image/jpeg">
                        <label for="file-input" class="file-label">Î•Ï€Î¯Î»ÎµÎ¾Îµ Î¦Ï‰Ï„Î¿Î³ÏÎ±Ï†Î¯Î±</label>
                        <button id="upload-btn">Î‘Î½Î­Î²Î±ÏƒÎ¼Î± Î¦Ï‰Ï„Î¿Î³ÏÎ±Ï†Î¯Î±Ï‚</button>
                    </div>
                </div>
            </div>
            
            <div id="view-calendar" class="view-container">
                <p>ÎŸÏÎ³Î¬Î½Ï‰ÏƒÎµ Ï„Î± Î±Î³Î±Ï€Î·Î¼Î­Î½Î± ÏƒÎ¿Ï… posts. ÎšÎ¬Î½Îµ drag & drop Î­Î½Î± caption Î±Ï€ÏŒ Ï„Î· Î»Î¯ÏƒÏ„Î± ÏƒÎµ Î¼Î¹Î± Î¼Î­ÏÎ± Ï„Î¿Ï… Î·Î¼ÎµÏÎ¿Î»Î¿Î³Î¯Î¿Ï….</p>
                <div id="calendar-container">
                    <div id="calendar-sidebar">
                        <h4>â­ Î‘Î³Î±Ï€Î·Î¼Î­Î½Î±</h4>
                        <div id="favorites-list"></div>
                    </div>
                    <div id="calendar-main">
                        <div class="calendar-grid" id="calendar-grid"></div>
                    </div>
                </div>
            </div>

            <div id="view-history" class="view-container">
                 <div class="history-controls">
                    <div class="tabs">
                        <button id="subtab-history" class="active">Î™ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ</button>
                        <button id="subtab-favorites">Î‘Î³Î±Ï€Î·Î¼Î­Î½Î±</button>
                    </div>
                    <input type="text" id="search-history" placeholder="Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·...">
                </div>
                <div id="history-results-container"></div>
            </div>
            
            <div id="view-settings" class="view-container">
                <h3>Î— Î¦Ï‰Î½Î® Ï„Î¿Ï… Brand ÏƒÎ¿Ï… (Brand Voice)</h3>
                <p>Î ÎµÏÎ¹Î­Î³ÏÎ±ÏˆÎµ Ï„Î¿ ÏÏ†Î¿Ï‚ ÎºÎ±Î¹ Ï„Î·Î½ Ï€ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÏŒÏ„Î·Ï„Î± Ï„Î¿Ï… brand ÏƒÎ¿Ï…. Î¤Î¿ AI Î¸Î± Î±ÎºÎ¿Î»Î¿Ï…Î¸ÎµÎ¯ Ï€Î¬Î½Ï„Î± Î±Ï…Ï„Î­Ï‚ Ï„Î¹Ï‚ Î¿Î´Î·Î³Î¯ÎµÏ‚.</p>
                <textarea id="brand-voice-input" rows="6" placeholder="Ï€.Ï‡., Î•Î¯Î¼Î±ÏƒÏ„Îµ Î­Î½Î± Ï€Î±Î¹Ï‡Î½Î¹Î´Î¹Î¬ÏÎ¹ÎºÎ¿ brand. Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ¼Îµ Î±Ï€Î»Î® Î³Î»ÏÏƒÏƒÎ±, Ï€Î¿Î»Î»Î¬ emojis ÎºÎ±Î¹ Ï€Î¬Î½Ï„Î± Ï‡Î¹Î¿ÏÎ¼Î¿Ï..."></textarea>
                <button id="save-settings-btn">Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Î¡Ï…Î¸Î¼Î¯ÏƒÎµÏ‰Î½</button>
            </div>
        </div> 

        <div id="spinner-container" class="spinner-container"><div class="spinner"></div></div>
        <div id="generation-results-container"></div>
    </div>

    <script>
    // --- Î’Î—ÎœÎ‘ 1: ÎŸÎ¡Î™Î£ÎœÎŸÎ£ ÎŸÎ›Î©Î Î¤Î©Î ÎœÎ•Î¤Î‘Î’Î›Î—Î¤Î©Î Î£Î¤Î—Î Î‘Î¡Î§Î— ---
    const textTab = document.getElementById('tab-text');
    const imageTab = document.getElementById('tab-image');
    const calendarTab = document.getElementById('tab-calendar');
    const historyTab = document.getElementById('tab-history');
    const settingsTab = document.getElementById('tab-settings');
    
    const textView = document.getElementById('view-text');
    const imageView = document.getElementById('view-image');
    const calendarView = document.getElementById('view-calendar');
    const historyView = document.getElementById('view-history');
    const settingsView = document.getElementById('view-settings');
    
    const generateTextBtn = document.getElementById('generate-text-btn');
    const generateImageBtn = document.getElementById('generate-image-btn');
    const uploadBtn = document.getElementById('upload-btn');
    const saveSettingsBtn = document.getElementById('save-settings-btn');

    const generationResultsContainer = document.getElementById('generation-results-container');
    const historyResultsContainer = document.getElementById('history-results-container');
    const spinnerContainer = document.getElementById('spinner-container');
    const themeSwitch = document.getElementById('theme-switch');
    const searchInput = document.getElementById('search-history');
    const historySubTab = document.getElementById('subtab-history');
    const favoritesSubTab = document.getElementById('subtab-favorites');
    const fileInput = document.getElementById('file-input');
    const brandVoiceInput = document.getElementById('brand-voice-input');
    const favoritesList = document.getElementById('favorites-list');
    const calendarGrid = document.getElementById('calendar-grid');

    let currentHistoryView = 'history';

    // --- Î’Î—ÎœÎ‘ 2: ÎŸÎ¡Î™Î£ÎœÎŸÎ£ ÎŸÎ›Î©Î Î¤Î©Î Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î•Î©Î ---
    const getStorage = (key) => JSON.parse(localStorage.getItem(key)) || [];
    const setStorage = (key, value) => localStorage.setItem(key, JSON.stringify(value));

    function createResultCard(text, isFavorite, container) {
        const card = document.createElement('div'); card.className = 'result-card';
        const textSpan = document.createElement('span'); textSpan.textContent = text.trim();
        const actionsDiv = document.createElement('div'); actionsDiv.className = 'card-actions';
        const copyBtn = document.createElement('button'); copyBtn.className = 'copy-btn'; copyBtn.innerHTML = 'ğŸ“‹'; copyBtn.title = 'Copy';
        copyBtn.onclick = () => { navigator.clipboard.writeText(textSpan.textContent); copyBtn.innerHTML = 'âœ…'; setTimeout(() => { copyBtn.innerHTML = 'ğŸ“‹'; }, 2000); };
        const favBtn = document.createElement('button'); favBtn.className = `fav-btn ${isFavorite ? 'favorited' : ''}`; favBtn.innerHTML = isFavorite ? 'â­' : 'â˜†'; favBtn.title = 'Favorite';
        favBtn.onclick = () => toggleFavorite(text, favBtn);
        actionsDiv.appendChild(copyBtn); actionsDiv.appendChild(favBtn); card.appendChild(textSpan); card.appendChild(actionsDiv);
        container.appendChild(card);
    }

    function renderHistory(filter = '') {
        historyResultsContainer.innerHTML = '';
        const favorites = getStorage('favorites');
        const items = (currentHistoryView === 'history') ? getStorage('history') : favorites;
        const filteredItems = items.filter(item => item.toLowerCase().includes(filter.toLowerCase()));
        filteredItems.forEach(item => {
            const isFav = favorites.includes(item);
            createResultCard(item, isFav, historyResultsContainer);
        });
    }

    function saveToHistory(newCaptions) {
        let history = getStorage('history');
        history = [...newCaptions, ...history];
        if (history.length > 50) history = history.slice(0, 50);
        setStorage('history', history);
    }

    function toggleFavorite(captionText, btn) {
        let favorites = getStorage('favorites');
        if (favorites.includes(captionText)) {
            favorites = favorites.filter(fav => fav !== captionText);
            btn.classList.remove('favorited'); btn.innerHTML = 'â˜†';
        } else {
            favorites.unshift(captionText);
            btn.classList.add('favorited'); btn.innerHTML = 'â­';
        }
        setStorage('favorites', favorites);
        renderHistory(searchInput.value);
    }
    
    function switchTab(activeTab, activeView) {
        [textTab, imageTab, calendarTab, historyTab, settingsTab].forEach(tab => tab.classList.remove('active'));
        [textView, imageView, calendarView, historyView, settingsView].forEach(view => view.classList.remove('active'));
        activeTab.classList.add('active');
        activeView.classList.add('active');
        generationResultsContainer.innerHTML = '';
        if (activeTab === historyTab) renderHistory(searchInput.value);
        if (activeTab === calendarTab) loadCalendarFeatures();
    }
    
    function performFetch(endpoint, payload, isImage = false) {
        spinnerContainer.style.display = 'flex';
        generationResultsContainer.innerHTML = '';
        fetch(endpoint, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        })
        .then(response => response.json())
        .then(data => {
            spinnerContainer.style.display = 'none';
            if (isImage) {
                if (data.image_url) {
                    const card = document.createElement('div');
                    card.id = 'image-result-card';
                    card.innerHTML = `<img src="${data.image_url}" alt="Generated Image">`;
                    generationResultsContainer.appendChild(card);
                } else {
                    generationResultsContainer.innerHTML = `<div class="result-card">${data.error || 'Error'}</div>`;
                }
            } else {
                if (data.caption) {
                    const newCaptions = data.caption.split(/\d+\./).filter(Boolean).map(s => s.trim());
                    saveToHistory(newCaptions);
                    const favorites = getStorage('favorites');
                    newCaptions.forEach(cap => createResultCard(cap, favorites.includes(cap), generationResultsContainer));
                } else {
                    generationResultsContainer.innerHTML = `<div class="result-card">${data.error || 'Error'}</div>`;
                }
            }
        })
        .catch(error => {
            spinnerContainer.style.display = 'none';
            generationResultsContainer.innerHTML = '<div class="result-card">Network error.</div>';
        });
    }
    
    function loadCalendarFeatures() {
        populateFavoritesSidebar();
        renderCalendar();
    }

    function populateFavoritesSidebar() {
        favoritesList.innerHTML = '';
        const favorites = getStorage('favorites');
        if (favorites.length === 0) {
            favoritesList.innerHTML = '<p style="font-size: 13px; color: var(--text-secondary);">Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î±Î³Î±Ï€Î·Î¼Î­Î½Î±.</p>';
            return;
        }
        favorites.forEach(text => {
            const item = document.createElement('div');
            item.className = 'favorite-item';
            item.textContent = text;
            item.draggable = true;
            item.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', text);
            });
            favoritesList.appendChild(item);
        });
    }

    function renderCalendar() {
        calendarGrid.innerHTML = '';
        const daysOfWeek = ['Î”Î•', 'Î¤Î¡', 'Î¤Î•', 'Î Î•', 'Î Î‘', 'Î£Î‘', 'ÎšÎ¥'];
        daysOfWeek.forEach(day => {
            const dayHeader = document.createElement('div');
            dayHeader.className = 'calendar-day-header';
            dayHeader.textContent = day;
            calendarGrid.appendChild(dayHeader);
        });

        for (let i = 1; i <= 31; i++) {
            const dayCell = document.createElement('div');
            dayCell.className = 'calendar-day';
            dayCell.dataset.day = i;
            
            const dayNumber = document.createElement('div');
            dayNumber.className = 'day-number';
            dayNumber.textContent = i;
            dayCell.appendChild(dayNumber);

            dayCell.addEventListener('dragover', (e) => { e.preventDefault(); dayCell.classList.add('drag-over'); });
            dayCell.addEventListener('dragleave', () => { dayCell.classList.remove('drag-over'); });
            dayCell.addEventListener('drop', (e) => {
                e.preventDefault();
                dayCell.classList.remove('drag-over');
                const captionText = e.dataTransfer.getData('text/plain');
                scheduleItem(i, captionText);
            });
            calendarGrid.appendChild(dayCell);
        }
        loadScheduledItems();
    }

    function scheduleItem(day, text) {
        let schedule = getStorage('schedule') || {};
        if (!schedule[day]) schedule[day] = [];
        if (schedule[day].includes(text)) return;
        schedule[day].push(text);
        setStorage('schedule', schedule);
        loadScheduledItems();
    }
    
    function loadScheduledItems() {
        const schedule = getStorage('schedule') || {};
        document.querySelectorAll('.scheduled-item').forEach(item => item.remove());
        for (const day in schedule) {
            const dayCell = document.querySelector(`.calendar-day[data-day='${day}']`);
            if (dayCell) {
                schedule[day].forEach(text => {
                    const scheduledItem = document.createElement('div');
                    scheduledItem.className = 'scheduled-item';
                    scheduledItem.textContent = text;
                    dayCell.appendChild(scheduledItem);
                });
            }
        }
    }

    // --- Î’Î—ÎœÎ‘ 3: ÎŸÎ›ÎŸÎ™ ÎŸÎ™ EVENT LISTENERS Î£Î¤ÎŸ Î¤Î•Î›ÎŸÎ£ ---
    textTab.addEventListener('click', () => switchTab(textTab, textView));
    imageTab.addEventListener('click', () => switchTab(imageTab, imageView));
    calendarTab.addEventListener('click', () => switchTab(calendarTab, calendarView));
    historyTab.addEventListener('click', () => switchTab(historyTab, historyView));
    settingsTab.addEventListener('click', () => switchTab(settingsTab, settingsView));

    historySubTab.addEventListener('click', () => { currentHistoryView = 'history'; historySubTab.classList.add('active'); favoritesSubTab.classList.remove('active'); renderHistory(searchInput.value); });
    favoritesSubTab.addEventListener('click', () => { currentHistoryView = 'favorites'; favoritesSubTab.classList.add('active'); historySubTab.classList.remove('active'); renderHistory(searchInput.value); });

    generateTextBtn.addEventListener('click', () => {
        const topic = document.getElementById('topic-input').value;
        if (!topic) return alert('Î Î±ÏÎ±ÎºÎ±Î»Ï, Î³ÏÎ¬ÏˆÎµ Î­Î½Î± Î¸Î­Î¼Î±!');
        const brandVoice = localStorage.getItem('brandVoice') || '';
        const payload = {
            topic: topic,
            keywords: document.getElementById('keywords').value,
            platform: document.getElementById('platform-select').value,
            contentType: document.getElementById('content-type-select').value,
            tone: document.getElementById('tone-select').value,
            language: document.getElementById('language-select').value,
            model_choice: document.getElementById('model-select').value,
            brand_voice: brandVoice
        };
        performFetch('/generate-caption', payload, false);
    });

    generateImageBtn.addEventListener('click', () => {
        const prompt = document.getElementById('image-prompt-input').value;
        if (!prompt) return alert('Î Î±ÏÎ±ÎºÎ±Î»Ï, Î´ÏÏƒÎµ Î¼Î¹Î± Ï€ÎµÏÎ¹Î³ÏÎ±Ï†Î® Î³Î¹Î± Ï„Î·Î½ ÎµÎ¹ÎºÏŒÎ½Î±!');
        const payload = {
            prompt: prompt,
            style: document.getElementById('image-style-select').value
        };
        performFetch('/generate-image', payload, true);
    });

    uploadBtn.addEventListener('click', () => {
        const file = fileInput.files[0];
        if (!file) return alert('Î Î±ÏÎ±ÎºÎ±Î»Ï, ÎµÏ€Î¯Î»ÎµÎ¾Îµ Ï€ÏÏÏ„Î± Î­Î½Î± Î±ÏÏ‡ÎµÎ¯Î¿!');
        const formData = new FormData();
        formData.append('file', file);
        spinnerContainer.style.display = 'flex';
        generationResultsContainer.innerHTML = '';
        fetch('/upload-image', { method: 'POST', body: formData })
        .then(response => response.json())
        .then(data => {
            spinnerContainer.style.display = 'none';
            if (data.image_url) {
                const card = document.createElement('div');
                card.id = 'image-result-card';
                card.innerHTML = `<img src="${data.image_url}" alt="Uploaded Image"><button class="analyze-btn">Î‘Î½Î¬Î»Ï…ÏƒÎ· Î•Î¹ÎºÏŒÎ½Î±Ï‚ Î¼Îµ AI</button>`;
                generationResultsContainer.appendChild(card);
                
                // Add event listener to the newly created button
                card.querySelector('.analyze-btn').onclick = () => analyzeImageWithAI(data.image_url);
            } else {
                generationResultsContainer.innerHTML = `<div class="result-card">${data.error || 'Error'}</div>`;
            }
        })
        .catch(error => {
            spinnerContainer.style.display = 'none';
            generationResultsContainer.innerHTML = '<div class="result-card">Network error.</div>';
        });
    });

    function analyzeImageWithAI(imageUrl) {
        spinnerContainer.style.display = 'flex';
        fetch('/analyze-image', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ image_url: imageUrl })
        })
        .then(response => response.json())
        .then(data => {
            spinnerContainer.style.display = 'none';
            if (data.description) {
                document.getElementById('topic-input').value = data.description;
                textTab.click();
                alert('Î— Î±Î½Î¬Î»Ï…ÏƒÎ· Ï„Î·Ï‚ ÎµÎ¹ÎºÏŒÎ½Î±Ï‚ Î¿Î»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ! Î— Ï€ÎµÏÎ¹Î³ÏÎ±Ï†Î® Ï€ÏÎ¿ÏƒÏ„Î­Î¸Î·ÎºÎµ ÏƒÏ„Î¿ "ÎšÏÏÎ¹Î¿ Î˜Î­Î¼Î±".');
            } else {
                alert(data.error || 'Î— Î±Î½Î¬Î»Ï…ÏƒÎ· Î±Ï€Î­Ï„Ï…Ï‡Îµ.');
            }
        })
        .catch(error => {
            spinnerContainer.style.display = 'none';
            alert('Î Î±ÏÎ¿Ï…ÏƒÎ¹Î¬ÏƒÏ„Î·ÎºÎµ ÏƒÏ†Î¬Î»Î¼Î± Î´Î¹ÎºÏ„ÏÎ¿Ï… ÎºÎ±Ï„Î¬ Ï„Î·Î½ Î±Î½Î¬Î»Ï…ÏƒÎ·.');
        });
    }

    saveSettingsBtn.addEventListener('click', () => {
        const brandVoice = brandVoiceInput.value;
        localStorage.setItem('brandVoice', brandVoice);
        saveSettingsBtn.textContent = 'Î‘Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎµ!';
        setTimeout(() => { saveSettingsBtn.textContent = 'Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Î¡Ï…Î¸Î¼Î¯ÏƒÎµÏ‰Î½'; }, 2000);
    });
    
    themeSwitch.addEventListener('click', () => {
        document.body.classList.toggle('dark-mode');
        if (document.body.classList.contains('dark-mode')) {
            localStorage.setItem('theme', 'dark');
            themeSwitch.textContent = 'â˜€ï¸';
        } else {
            localStorage.setItem('theme', 'light');
            themeSwitch.textContent = 'ğŸŒ™';
        }
    });
    
    searchInput.addEventListener('input', (e) => renderHistory(e.target.value));
    
    document.addEventListener('DOMContentLoaded', () => {
        if (localStorage.getItem('theme') === 'dark') {
            document.body.classList.add('dark-mode');
            themeSwitch.textContent = 'â˜€ï¸';
        }
        const savedBrandVoice = localStorage.getItem('brandVoice') || '';
        brandVoiceInput.value = savedBrandVoice;
        textTab.click();
    });
    </script>
</body>
</html>
