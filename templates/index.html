<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Social Media Assistant</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

    <div class="container">
        <div class="theme-switch" id="theme-switch" title="Toggle dark mode">ğŸŒ™</div>
        <h1>AI Social Media Assistant</h1>
        <p>Î”Î·Î¼Î¹Î¿ÏÏÎ³Î·ÏƒÎµ Hooks, CTAs ÎºÎ±Î¹ Captions Î³Î¹Î± Ï„Î± social media ÏƒÎ¿Ï… ÏƒÎµ Î´ÎµÏ…Ï„ÎµÏÏŒÎ»ÎµÏ€Ï„Î±.</p>

        <div class="form-controls">
            <input type="text" id="topic-input" placeholder="ÎšÏÏÎ¹Î¿ Î¸Î­Î¼Î±...">
            <input type="text" id="keywords" placeholder="Î›Î­Î¾ÎµÎ¹Ï‚-ÎºÎ»ÎµÎ¹Î´Î¹Î¬ (Ï€.Ï‡. Ï€ÏÎ¿ÏƒÏ†Î¿ÏÎ¬, Î½Î­Î¿)...">
            
            <select id="platform-select">
                <option value="Instagram">Instagram</option>
                <option value="TikTok">TikTok</option>
                <option value="Facebook">Facebook</option>
                <option value="Pinterest">Pinterest</option>
                <option value="YouTube">YouTube</option>
            </select>
            
            <select id="content-type-select">
                <option value="Caption">Full Caption</option>
                <option value="Hook">ÎœÏŒÎ½Î¿ Hook</option>
                <option value="CTA">ÎœÏŒÎ½Î¿ CTA</option>
                <option value="Hashtags">ÎœÏŒÎ½Î¿ Hashtags</option>
            </select>

            <select id="tone-select">
                <option value="Friendly">Î¦Î¹Î»Î¹ÎºÏŒ</option>
                <option value="Professional">Î•Ï€Î±Î³Î³ÎµÎ»Î¼Î±Ï„Î¹ÎºÏŒ</option>
                <option value="Funny">Î‘ÏƒÏ„ÎµÎ¯Î¿</option>
                <option value="Enthusiastic">Î•Î½Î¸Î¿Ï…ÏƒÎ¹ÏÎ´ÎµÏ‚</option>
            </select>

            <select id="language-select">
                <option value="Greek">Î•Î»Î»Î·Î½Î¹ÎºÎ¬</option>
                <option value="English">Î‘Î³Î³Î»Î¹ÎºÎ¬</option>
            </select>
        </div>

        <button id="generate-btn">Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î ÎµÏÎ¹ÎµÏ‡Î¿Î¼Î­Î½Î¿Ï…</button>

        <div id="spinner-container" class="spinner-container">
            <div class="spinner"></div>
        </div>
        
        <div class="history-controls">
            <div class="tabs">
                <button id="tab-history" class="active">Î™ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ</button>
                <button id="tab-favorites">Î‘Î³Î±Ï€Î·Î¼Î­Î½Î±</button>
            </div>
            <input type="text" id="search-history" placeholder="Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·...">
        </div>

        <div id="results-container"></div>
    </div>

    <script>
    // --- DOM Elements ---
    const generateBtn = document.getElementById('generate-btn');
    const resultsContainer = document.getElementById('results-container');
    const spinnerContainer = document.getElementById('spinner-container');
    const themeSwitch = document.getElementById('theme-switch');
    const searchInput = document.getElementById('search-history');
    const historyTab = document.getElementById('tab-history');
    const favoritesTab = document.getElementById('tab-favorites');

    let currentView = 'history'; // 'history' or 'favorites'

    // --- Core Functions ---
    const getStorage = (key) => JSON.parse(localStorage.getItem(key)) || [];
    const setStorage = (key, value) => localStorage.setItem(key, JSON.stringify(value));

    function createResultCard(captionText, isFavorite) {
        const card = document.createElement('div');
        card.className = 'result-card';
        
        const textSpan = document.createElement('span');
        textSpan.textContent = captionText.trim();
        
        const actionsDiv = document.createElement('div');
        actionsDiv.className = 'card-actions';

        const copyBtn = document.createElement('button');
        copyBtn.className = 'copy-btn';
        copyBtn.innerHTML = 'ğŸ“‹';
        copyBtn.title = 'Copy';
        copyBtn.onclick = () => {
            navigator.clipboard.writeText(textSpan.textContent);
            copyBtn.innerHTML = 'âœ…';
            setTimeout(() => { copyBtn.innerHTML = 'ğŸ“‹'; }, 2000);
        };

        const favBtn = document.createElement('button');
        favBtn.className = `fav-btn ${isFavorite ? 'favorited' : ''}`;
        favBtn.innerHTML = isFavorite ? 'â­' : 'â˜†';
        favBtn.title = 'Favorite';
        favBtn.onclick = () => toggleFavorite(captionText, favBtn);

        actionsDiv.appendChild(copyBtn);
        actionsDiv.appendChild(favBtn);
        card.appendChild(textSpan);
        card.appendChild(actionsDiv);
        return card;
    }

    function renderResults(filter = '') {
        resultsContainer.innerHTML = '';
        const favorites = getStorage('favorites');
        const items = (currentView === 'history') ? getStorage('history') : favorites;
        
        const filteredItems = items.filter(item => item.toLowerCase().includes(filter.toLowerCase()));

        filteredItems.forEach(item => {
            const isFav = favorites.includes(item);
            const card = createResultCard(item, isFav);
            resultsContainer.appendChild(card);
        });
    }

    function saveToHistory(newCaptions) {
        let history = getStorage('history');
        history = [...newCaptions.reverse(), ...history];
        if (history.length > 50) history = history.slice(0, 50);
        setStorage('history', history);
    }

    function toggleFavorite(captionText, btn) {
        let favorites = getStorage('favorites');
        const index = favorites.indexOf(captionText);
        if (index > -1) {
            favorites.splice(index, 1); // Remove from favorites
            btn.classList.remove('favorited');
            btn.innerHTML = 'â˜†';
        } else {
            favorites.unshift(captionText); // Add to favorites
            btn.classList.add('favorited');
            btn.innerHTML = 'â­';
        }
        setStorage('favorites', favorites);
        if (currentView === 'favorites') renderResults();
    }

    // --- Event Listeners ---
    generateBtn.addEventListener('click', () => {
        const topic = document.getElementById('topic-input').value;
        if (!topic) return alert('Î Î±ÏÎ±ÎºÎ±Î»Ï, Î³ÏÎ¬ÏˆÎµ Î­Î½Î± Î¸Î­Î¼Î±!');
        
        spinnerContainer.style.display = 'flex';
        resultsContainer.style.display = 'none';
        
        const payload = {
            topic: topic,
            keywords: document.getElementById('keywords').value,
            platform: document.getElementById('platform-select').value,
            contentType: document.getElementById('content-type-select').value,
            tone: document.getElementById('tone-select').value,
            language: document.getElementById('language-select').value,
        };

        fetch('/generate-caption', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        })
        .then(response => response.json())
        .then(data => {
            spinnerContainer.style.display = 'none';
            resultsContainer.style.display = 'block';

            if (data.caption) {
                const newCaptions = data.caption.split(/\d+\./).filter(Boolean).map(s => s.trim());
                saveToHistory(newCaptions);
                historyTab.click(); // Switch to history view to show new results
            } else {
                resultsContainer.innerHTML = `<div class="result-card">${data.error || 'Error'}</div>`;
            }
        })
        .catch(error => {
            spinnerContainer.style.display = 'none';
            resultsContainer.style.display = 'block';
            resultsContainer.innerHTML = '<div class="result-card">Network error.</div>';
        });
    });

    themeSwitch.addEventListener('click', () => {
        document.body.classList.toggle('dark-mode');
        if (document.body.classList.contains('dark-mode')) {
            localStorage.setItem('theme', 'dark');
            themeSwitch.textContent = 'â˜€ï¸';
        } else {
            localStorage.setItem('theme', 'light');
            themeSwitch.textContent = 'ğŸŒ™';
        }
    });
    
    searchInput.addEventListener('input', (e) => renderResults(e.target.value));

    historyTab.addEventListener('click', () => {
        currentView = 'history';
        historyTab.classList.add('active');
        favoritesTab.classList.remove('active');
        renderResults(searchInput.value);
    });

    favoritesTab.addEventListener('click', () => {
        currentView = 'favorites';
        favoritesTab.classList.add('active');
        historyTab.classList.remove('active');
        renderResults(searchInput.value);
    });

    // --- Initial Load ---
    document.addEventListener('DOMContentLoaded', () => {
        if (localStorage.getItem('theme') === 'dark') {
            document.body.classList.add('dark-mode');
            themeSwitch.textContent = 'â˜€ï¸';
        }
        historyTab.click();
    });
    </script>
</body>
</html>